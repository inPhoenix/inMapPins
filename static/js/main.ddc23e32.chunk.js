(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{265:function(e,t,n){e.exports=n(471)},471:function(e,t,n){"use strict";n.r(t);var a=n(24),r=n(0),c=n.n(r),i=n(32),o=n.n(i),l=n(480),u=n(482),s=n(481),m=n(19),p=n(85),d=n.n(p),g=n(86),f=n.n(g),E=n(72),h=n.n(E),b=Object(m.createMuiTheme)({palette:{primary:{light:d.a[300],main:d.a[500],dark:d.a[700]},secondary:{light:f.a[300],main:f.a[500],dark:f.a[700]}},typography:{useNextVariants:!0}});var v=function(e){return function(t){return c.a.createElement(m.MuiThemeProvider,{theme:b},c.a.createElement(h.a,null),c.a.createElement(e,t))}},O=Object(r.createContext)({currentUser:null,isAuth:!1,draft:null,pins:[],currentPin:null}),y=n(73),x=n.n(y),j=n(74),N=n.n(j),w=n(175),C=n.n(w),I=n(21),_=n.n(I),S=n(80),k=n(174),T=n.n(k),P=Object(m.withStyles)({root:{cursor:"pointer",display:"flex"},buttonText:{color:"orange"},buttonIcon:{marginLeft:"5px",color:"orange"}})(function(e){var t=e.classes,n=Object(r.useContext)(O).dispatch;return c.a.createElement(S.GoogleLogout,{onLogoutSuccess:function(){n({type:"SIGNOUT_USER"})},render:function(e){var n=e.onClick;return c.a.createElement("span",{className:t.root,onClick:n},c.a.createElement(_.a,{variant:"body1",className:t.buttonText},"Signout"),c.a.createElement(T.a,{className:t.buttonIcon}))}})}),A=Object(m.withStyles)(function(e){return{root:{flexGrow:1},grow:{flexGrow:1,display:"flex",alignItems:"center"},icon:{marginRight:e.spacing.unit,color:"green",fontSize:45},mobile:{display:"none"},picture:{height:"50px",borderRadius:"90%",marginRight:2*e.spacing.unit}}})(function(e){var t=e.classes,n=Object(r.useContext)(O).state.currentUser;return c.a.createElement("div",{className:t.root},c.a.createElement(x.a,{position:"static"},c.a.createElement(N.a,null,c.a.createElement("div",{className:t.grow},c.a.createElement(C.a,{className:t.icon}),c.a.createElement(_.a,{component:"h1",variant:"h6",color:"inherit",noWrap:!0},"GeoPins")),n&&c.a.createElement("div",{className:t.grow},c.a.createElement("img",{className:t.picture,src:n.picture,alt:n.name}),c.a.createElement(_.a,{variant:"h5",noWrap:!0,color:"inherit"},n.name)),c.a.createElement(P,null))))}),L=n(28),D=n(25),R=n.n(D),G=n(35),F=n(45),z=n(177),$=n.n(z),B=function(e){var t=e.size,n=e.color,a=e.onClick;return c.a.createElement($.a,{onClick:a,style:{fontSize:t,color:n}})},U=n(81),M="https://ingeopins.herokuapp.com/graphql",W=function(){var e=Object(r.useState)(""),t=Object(a.a)(e,2),n=t[0],c=t[1];return Object(r.useEffect)(function(){var e=window.gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().id_token;c(e)},[]),new U.GraphQLClient(M,{headers:{authorization:n},mode:"cors"})},q=n(122),Y=n(178),J=n.n(Y),H=n(58),Q=n.n(H),V=n(41),X=n.n(V),K=n(180),Z=n.n(K),ee=n(179),te=n.n(ee),ne=n(82),ae=n.n(ne),re=n(181),ce=n.n(re),ie=Object(m.withStyles)(function(e){return{form:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",paddingBottom:e.spacing.unit},contentField:{marginLeft:e.spacing.unit,marginRight:e.spacing.unit,width:"95%"},input:{display:"none"},alignCenter:{display:"flex",alignItems:"center"},iconLarge:{fontSize:40,marginRight:e.spacing.unit},leftIcon:{fontSize:20,marginRight:e.spacing.unit},rightIcon:{fontSize:20,marginLeft:e.spacing.unit},button:{marginTop:2*e.spacing.unit,marginBottom:2*e.spacing.unit,marginRight:e.spacing.unit,marginLeft:0}}})(function(e){var t=e.classes,n=W(),i=Object(r.useContext)(O),o=i.state,l=i.dispatch,u=Object(r.useState)(""),s=Object(a.a)(u,2),m=s[0],p=s[1],d=Object(r.useState)(""),g=Object(a.a)(d,2),f=g[0],E=g[1],h=Object(r.useState)(""),b=Object(a.a)(h,2),v=b[0],y=b[1],x=Object(r.useState)(!1),j=Object(a.a)(x,2),N=j[0],w=j[1],C=function(){var e=Object(G.a)(R.a.mark(function e(){var t,n;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new FormData).append("file",f),t.append("upload_preset","geopins"),t.append("cloud_name","inphoenix"),e.next=6,J.a.post("https://api.cloudinary.com/v1_1/inphoenix/image/upload",t);case 6:return n=e.sent,console.log("%c res.data","background: red",n.data.url),e.abrupt("return",n.data.url);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),I=function(){p(""),E(""),y(""),l({type:"DELETE_DRAFT"})},S=function(){var e=Object(G.a)(R.a.mark(function e(t){var a,r,c,i,u,s,p;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.preventDefault(),w(!0),e.next=5,C();case 5:return a=e.sent,r=o.draft,c=r.latitude,i=r.longitude,u={title:m,image:a,content:v,latitude:c,longitude:i},e.next=10,n.request("\n  mutation($title: String!, $image: String!, $content: String!, $latitude: Float!, $longitude: Float!) {\n    createPin(input: {\n      title: $title,\n      image: $image,\n      content: $content,\n      latitude: $latitude,\n      longitude: $longitude\n    }) {\n        _id\n        createdAt\n        title\n        image\n        content\n        latitude\n        longitude\n        author {\n          _id\n          name\n          email\n          picture\n        }\n      }\n  }\n",u);case 10:s=e.sent,p=s.createPin,l({type:"CREATE_PIN",payload:p}),I(),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(0),w(!1),console.error("%c err","background: red",e.t0);case 20:case"end":return e.stop()}},e,this,[[0,16]])}));return function(t){return e.apply(this,arguments)}}();return c.a.createElement("form",{className:t.form},c.a.createElement(_.a,{className:t.alignCenter,component:"h2",variant:"h4",color:"secondary"},c.a.createElement(te.a,{className:t.iconLarge},"Pin Location")),c.a.createElement("div",null,c.a.createElement(Q.a,{name:"title",label:"title",placeholder:"insert pin title",onChange:function(e){return p(e.target.value)}}),c.a.createElement("input",{accept:"image/*",id:"image",type:"file",className:t.input,onChange:function(e){return E(e.target.files[0])}}),c.a.createElement("label",{htmlFor:"image"},c.a.createElement(X.a,{style:{color:f&&"green"},component:"span",size:"small",className:t.button},c.a.createElement(Z.a,null)))),c.a.createElement("div",{className:t.contentField},c.a.createElement(Q.a,{name:"content",label:"content",multiline:!0,rows:"6",margin:"normal",fullWidth:!0,variant:"outlined",onChange:function(e){return y(e.target.value)}})),c.a.createElement("div",null,c.a.createElement(X.a,{onClick:I,className:t.button,variant:"contained",color:"primary"},c.a.createElement(ae.a,{className:t.leftIcon}),"Discard"),c.a.createElement(X.a,{disabled:!m.trim()||!v.trim()||N,onClick:S,className:t.button,variant:"contained",color:"secondary"},c.a.createElement(ce.a,{className:t.rightIcon}),"Submit")))}),oe=n(182),le=n.n(oe),ue=Object(m.withStyles)(function(e){return{root:{display:"flex",alignItems:"center",flexDirection:"column",justifyContent:"center"},icon:{margin:e.spacing.unit,fontSize:"80px"}}})(function(e){var t=e.classes;return c.a.createElement("div",{className:t.root},c.a.createElement(le.a,{className:t.icon}),c.a.createElement(_.a,{noWrap:!0,component:"h2",variant:"h6",align:"center",color:"textPrimary",gutterBottom:!0},"click on the map to add a pin"))}),se=n(42),me=n.n(se),pe=n(59),de=n.n(pe),ge=n(183),fe=n.n(ge),Ee=n(75),he=n.n(Ee),be=Object(m.withStyles)(function(e){return{form:{display:"flex",alignItems:"center"},input:{marginLeft:8,flex:1},clearButton:{padding:0,color:"red"},sendButton:{padding:0,color:e.palette.secondary.dark}}})(function(e){var t=e.classes,n=W(),i=Object(r.useContext)(O),o=i.state,l=i.dispatch,u=Object(r.useState)(""),s=Object(a.a)(u,2),m=s[0],p=s[1],d=function(){var e=Object(G.a)(R.a.mark(function e(){var t,a,r;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={pinId:o.currentPin._id,text:m},e.next=3,n.request("\n  mutation($pinId: ID!, $text: String!) {\n    createComment(pinId: $pinId, text: $text) {\n      _id\n      createdAt\n      title\n      content\n      image\n      latitude\n      longitude\n      author {\n        _id\n        name\n      }\n      comments {\n        text\n        createdAt\n        author {\n          name\n          picture\n        }\n      }\n    }\n  }\n",t);case 3:a=e.sent,r=a.createComment,l({type:"CREATE_COMPONENT",payload:r}),p("");case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}();return c.a.createElement(c.a.Fragment,null,c.a.createElement("form",{className:t.form},c.a.createElement(de.a,{onClick:function(){return p("")},disabled:!m.trim(),className:t.clearButton},c.a.createElement(ae.a,null)),c.a.createElement(me.a,{onChange:function(e){return p(e.target.value)},value:m,multiline:!0,className:t.input,placeholder:"Add Comment"}),c.a.createElement(de.a,{disabled:!m.trim(),className:t.sendButton},c.a.createElement(fe.a,{onClick:d}))),c.a.createElement(he.a,null))}),ve=n(57),Oe=n.n(ve),ye=n(76),xe=n.n(ye),je=n(79),Ne=n.n(je),we=n(77),Ce=n.n(we),Ie=n(78),_e=n.n(Ie),Se=n(184),ke=n.n(Se),Te=Object(m.withStyles)(function(e){return{root:{width:"100%",backgroundColor:e.palette.background.paper},inline:{display:"inline"}}})(function(e){var t=e.comments,n=e.classes;return c.a.createElement(Oe.a,{className:n.root},t.map(function(e,t){return c.a.createElement(xe.a,{key:t,alignItems:"flex-start"},c.a.createElement(Ce.a,null,c.a.createElement(_e.a,{src:e.author.picture,alt:e.author.name})),c.a.createElement(Ne.a,{primary:e.text,secondary:c.a.createElement(c.a.Fragment,null,c.a.createElement(_.a,{className:n.inline,component:"span",color:"textPrimary"},e.author.name)," ",ke()(Number(e.createdAt))," ago")}))}))}),Pe=n(124),Ae=n.n(Pe),Le=n(186),De=n.n(Le),Re=n(185),Ge=n.n(Re),Fe=Object(m.withStyles)(function(e){return{root:{padding:"1em 0.5em",textAlign:"center",width:"100%"},icon:{marginLeft:e.spacing.unit,marginRight:e.spacing.unit},text:{display:"flex",alignItems:"center",justifyContent:"center"}}})(function(e){var t=e.classes,n=Object(r.useContext)(O).state.currentPin,a=n.title,i=n.content,o=n.author,l=n.createdAt,u=n.comments;return c.a.createElement("div",{className:t.root},c.a.createElement(_.a,{component:"h2",variant:"h4",color:"primary",gutterBottom:!0},a),c.a.createElement(_.a,{className:t.text,component:"h4",variant:"h6",color:"inherit",gutterBottom:!0},c.a.createElement(De.a,{className:t.icon})," ",o.name),c.a.createElement(_.a,{className:t.text,variant:"subtitle2",color:"inherit",gutterBottom:!0},c.a.createElement(Ae.a,{className:t.icon}),Ge()(Number(l),"MMM Do YYYY")),c.a.createElement(_.a,{variant:"subtitle1",gutterBottom:!0},c.a.createElement(Ae.a,{className:t.icon}),i),c.a.createElement(be,null),c.a.createElement(Te,{comments:u}))}),ze=Object(m.withStyles)({root:{minWidth:350,maxWidth:400,maxHeight:"calc(100vh - 64px)",overflowY:"scroll",display:"flex",justifyContent:"center"},rootMobile:{maxWidth:"100%",maxHeight:300,overflowX:"hidden",overflowY:"scroll"}})(function(e){var t=e.classes,n=Object(r.useContext)(O).state,a=n.draft,i=n.currentPin,o=null;return a||i?a&&!i?o=ie:!a&&i&&(o=Fe):o=ue,c.a.createElement(q.a,{className:t.root},c.a.createElement(o,null))}),$e=n(187),Be=n.n($e),Ue=n(188),Me=n.n(Ue),We={latitude:37.7577,longitude:-122.4376,zoom:13},qe=Object(m.withStyles)({root:{display:"flex"},rootMobile:{display:"flex",flexDirection:"column-reverse"},navigationControl:{position:"absolute",top:0,left:0,margin:"1em"},deleteIcon:{color:"red"},popupImage:{padding:"0.4em",height:200,width:200,objectFit:"cover"},popupTab:{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"}})(function(e){var t=e.classes,n=W(),i=Object(r.useContext)(O),o=i.state,l=i.dispatch;Object(r.useEffect)(function(){x()},[]);var u=Object(r.useState)(We),s=Object(a.a)(u,2),m=s[0],p=s[1],d=Object(r.useState)(We),g=Object(a.a)(d,2),f=g[0],E=g[1];Object(r.useEffect)(function(){j()},[]);var h=Object(r.useState)(null),b=Object(a.a)(h,2),v=b[0],y=b[1],x=function(){var e=Object(G.a)(R.a.mark(function e(){var t,a;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.request("\n{\n   getPins {\n     _id\n     createdAt\n     title\n     image\n     content\n     latitude\n     longitude\n     author {\n       _id\n       name\n       email\n       picture\n     }\n     comments {\n       text\n       createdAt\n       author {\n        _id\n        name\n        picture\n       }\n     }\n   }\n}\n");case 2:t=e.sent,a=t.getPins,l({type:"GET_PINS",payload:a});case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),j=function(){"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(function(e){var t=e.coords,n=t.latitude,a=t.longitude;p(Object(L.a)({},m,{latitude:n,longitude:a})),E({latitude:n,longitude:a})})},N=function(e){return Be()(Date.now(),Number(e.createdAt))<=30?"MidnightBlue":"darkblue"},w=function(){var e=Object(G.a)(R.a.mark(function e(t){var a,r,c;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={pinId:t._id},e.next=3,n.request("\n  mutation($pinId: ID!) {\n    deletePin(pinId: $pinId) {\n      _id\n    }\n  }\n",a);case 3:r=e.sent,c=r.deletePin,l({type:"DELETE_PIN",payload:c}),y(null);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}();console.log("%c popup","background: red",v);var C=v&&v.image&&v.image.replace(/^http:\/\//i,"https://");return c.a.createElement("div",{className:t.root},c.a.createElement(F.d,Object.assign({width:"100vw",height:"calc(50vw - 64px)",mapStyle:"mapbox://styles/mapbox/streets-v9",mapboxApiAccessToken:"pk.eyJ1IjoiaW5waG9lbml4IiwiYSI6ImNqc3JmaDEzNDE0NHEzeW9leXdiYTd4OWUifQ.0KPCpScd-8u--GCnwOpG7g",onViewportChange:function(e){return p(e)},onClick:function(e){var t=e.lngLat,n=e.leftButton,r=Object(a.a)(t,2),c=r[0],i=r[1];n&&(o.draft||l({type:"CREATE_DRAFT"}),l({type:"UPDATE_DRAFT_LOCATION",payload:{longitude:c,latitude:i}}))}},m),c.a.createElement("div",{className:t.navigationControl},c.a.createElement(F.b,{onViewportChange:function(e){return p(e)}})),f&&c.a.createElement(F.a,{latitude:f.latitude,longitude:f.longitude,offsetLeft:-19,offsetTop:-37},c.a.createElement(B,{size:40,color:"red"})),o.draft&&c.a.createElement(F.a,{latitude:o.draft.latitude,longitude:o.draft.longitude,offsetLeft:-19,offsetTop:-37},c.a.createElement(B,{size:40,color:"hotpink"})),o.pins.map(function(e){return c.a.createElement(F.a,{key:e._id,latitude:e.latitude,longitude:e.longitude,offsetLeft:-19,offsetTop:-37},c.a.createElement(B,{onClick:function(){return function(e){y(e),l({type:"SET_PIN",payload:e})}(e)},size:40,color:N(e)}))}),v&&c.a.createElement(F.c,{anchor:"top",latitude:v.latitude,longitude:v.longitude,closeOnClick:!1,onClose:function(){return y(null)}},c.a.createElement("img",{className:t.popupImage,src:C,alt:v.title}),c.a.createElement("div",{className:t.popupTab},c.a.createElement(_.a,null,v.latitude.toFixed(6),",",v.longitude.toFixed(6)),o.currentUser._id===v.author._id&&c.a.createElement(X.a,{onClick:function(){return w(v)}},c.a.createElement(Me.a,{className:t.deleteIcon}))))),c.a.createElement(ze,null))}),Ye=v(function(){return c.a.createElement("div",null,c.a.createElement(A,null),c.a.createElement(qe,null))}),Je=Object(m.withStyles)({root:{height:"100vh",display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center"}})(function(e){var t=e.classes,n=Object(r.useContext)(O).dispatch,a=function(e){n({type:"IS_LOGGED_IN",payload:!1}),console.error(e)},i=function(){var e=Object(G.a)(R.a.mark(function e(t){var r,c,i;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=t.getAuthResponse().id_token,c=new U.GraphQLClient(M,{headers:{authorization:r},mode:"cors"}),e.next=5,c.request("{\n  me {\n    _id\n    name\n    email\n    picture\n  }\n}");case 5:i=e.sent,n({type:"LOGIN_USER",payload:i.me}),n({type:"IS_LOGGED_IN",payload:t.isSignedIn()}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),a(e.t0);case 13:case"end":return e.stop()}},e,this,[[0,10]])}));return function(t){return e.apply(this,arguments)}}();return c.a.createElement("div",{className:t.root},c.a.createElement(_.a,{component:"h1",variant:"h3",gutterBottom:!0,noWrap:!0,style:{color:"rgb(66, 133, 244)"}},"Welcome"),c.a.createElement(S.GoogleLogin,{onFailure:a,clientId:"965981121477-bj23k72m4ub5j9vqaiaplmqdgjnqfk47.apps.googleusercontent.com",onSuccess:i,isSignedIn:!0,buttonText:"Login with Google",theme:"dark"}))}),He=n(479),Qe=function(){return Object(r.useContext)(O).state.isAuth?c.a.createElement(He.a,{to:"/inMapPins/"}):c.a.createElement("div",null,c.a.createElement(Je,null))},Ve=n(460);function Xe(e,t){var n=t.type,a=t.payload;switch(n){case"LOGIN_USER":return Object(L.a)({},e,{currentUser:a});case"IS_LOGGED_IN":return Object(L.a)({},e,{isAuth:a});case"SIGNOUT_USER":return Object(L.a)({},e,{isAuth:!1,currentUser:null});case"CREATE_DRAFT":return Object(L.a)({},e,{currentPin:null,draft:{latitude:0,longitude:0}});case"GET_PINS":return Object(L.a)({},e,{pins:a});case"CREATE_PIN":var r=a,c=e.pins.filter(function(e){return e._id!==r._id});return Object(L.a)({},e,{pins:[].concat(Object(Ve.a)(c),[r])});case"UPDATE_DRAFT_LOCATION":return Object(L.a)({},e,{draft:a});case"DELETE_DRAFT":return Object(L.a)({},e,{draft:null});case"SET_PIN":return Object(L.a)({},e,{currentPin:a,draft:null});case"DELETE_PIN":var i=a,o=e.pins.filter(function(e){return e._id!==i._id});return Object(L.a)({},e,{pins:o,currentPin:null});case"CREATE_COMPONENT":var l=a,u=e.pins.map(function(e){return e._id===l._id?l:e});return Object(L.a)({},e,{pins:u,currentPin:l});default:return e}}n(446);var Ke=n(462),Ze=function(e){var t=e.component,n=Object(Ke.a)(e,["component"]),a=Object(r.useContext)(O).state;return c.a.createElement(s.a,Object.assign({render:function(e){return a.isAuth?c.a.createElement(t,e):c.a.createElement(He.a,{to:"".concat("/inMapPins/","login")})}},n))},et=n(459),tt=n(172),nt=n(461),at=n(478),rt=new nt.a({uri:"wss://ingeopins.herokuapp.com:4000/graphql",options:{reconnect:!0}}),ct=new tt.a({link:rt,cache:new at.a});o.a.render(c.a.createElement(function(){var e=Object(r.useContext)(O),t=Object(r.useReducer)(Xe,e),n=Object(a.a)(t,2),i=n[0],o=n[1];return c.a.createElement(l.a,null,c.a.createElement(et.ApolloProvider,{client:ct},c.a.createElement(O.Provider,{value:{state:i,dispatch:o}},c.a.createElement(u.a,null,c.a.createElement(Ze,{exact:!0,path:"/inMapPins/",component:Ye}),c.a.createElement(s.a,{path:"".concat("/inMapPins/","login"),component:Qe})))))},null),document.getElementById("root"))}},[[265,2,1]]]);
//# sourceMappingURL=main.ddc23e32.chunk.js.map